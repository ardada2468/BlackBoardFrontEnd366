{"version":3,"sources":["../../source/client/render.js"],"names":["React","ReactDOM","isServerSidePreloaded","isServerSideRendered","render","renderParameters","container","firstRender","renderPage","window","_react_pages_hot_reload","then","element","containerProps","rest","renderReactElementTree","createElement","getReactContainerElement","result","rerender","to","hydrate","firstChild","removeChild","getGlobalVariable","name","variable","undefined","document","getElementById","body","Error","setAttribute","appendChild"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\nimport { isServerSidePreloaded, isServerSideRendered } from './flags'\r\n\r\n// Performs client-side React application rendering.\r\n// Takes `render()` function which renders the actual page.\r\n// Then this rendered page is rendered in a `container`\r\n// (e.g. Redux state `<Connector/>` and such).\r\n// This function is not exported and is not called directly in an application:\r\n// instead specific implementations call this function\r\n// providing their own `render()` logic\r\n// (e.g. Redux + React-router, React-router).\r\n//\r\nexport default function render({ render, renderParameters = {}, container }) {\r\n\tlet firstRender = true\r\n\t// Renders current React page (inside a container).\r\n\t// Returns a Promise for an object holding\r\n\t// `render` function for development mode hot reload,\r\n\t// and also `store` (if Redux is used).\r\n\tfunction renderPage() {\r\n\t\tif (firstRender) {\r\n\t\t\tfirstRender = false\r\n\t\t} else {\r\n\t\t\twindow._react_pages_hot_reload = true\r\n\t\t}\r\n\t\treturn render(renderParameters).then(({ element, containerProps, ...rest }) => {\r\n\t\t\t// if (locale) {\r\n\t\t\t// \tcontainerProps.locale = locale\r\n\t\t\t// }\r\n\t\t\trenderReactElementTree(\r\n\t\t\t\t// Render page `element` inside a container element.\r\n\t\t\t\t// E.g. Redux context `<Provider/>`, and others.\r\n\t\t\t\tReact.createElement(container, containerProps, element),\r\n\t\t\t\t// DOM element to which React markup will be rendered\r\n\t\t\t\tgetReactContainerElement()\r\n\t\t\t)\r\n\t\t\twindow._react_pages_hot_reload = false\r\n\t\t\treturn rest\r\n\t\t})\r\n\t}\r\n\t// Render the page on the client side.\r\n\treturn renderPage().then((result) => ({\r\n\t\t// Redux `store`, for example.\r\n\t\t...result,\r\n\t\t// Client side code can then rerender the page any time\r\n\t\t// by calling this `render()` function\r\n\t\t// (makes hot reload work in development mode).\r\n\t\trerender: renderPage\r\n\t}))\r\n}\r\n\r\n// Renders React element to a DOM node\r\nfunction renderReactElementTree(element, to) {\r\n\t// If using React >= 16 and the content is Server-Side Rendered.\r\n\tif (isServerSidePreloaded() && isServerSideRendered() && ReactDOM.hydrate) {\r\n\t\t// New API introduced in React 16\r\n\t\t// for \"hydrating\" Server-Side Rendered markup.\r\n\t\t// https://reactjs.org/docs/react-dom.html#hydrate\r\n\t\treturn ReactDOM.hydrate(element, to)\r\n\t}\r\n\t// Clears `element` to prevent React warning:\r\n\t// \"Calling ReactDOM.render() to hydrate server-rendered markup\r\n\t//  will stop working in React v17. Replace the ReactDOM.render() call\r\n\t//  with ReactDOM.hydrate() if you want React to attach to the server HTML.\"\r\n\tif (!window._react_pages_hot_reload) {\r\n\t\twhile (to.firstChild) {\r\n\t\t\tto.removeChild(to.firstChild)\r\n\t\t}\r\n\t}\r\n\treturn ReactDOM.render(element, to)\r\n}\r\n\r\n// Retrieves a variable from `window` erasing it.\r\nfunction getGlobalVariable(name) {\r\n\tconst variable = window[name]\r\n\tif (variable !== undefined) {\r\n\t\tdelete window[name]\r\n\t}\r\n\treturn variable\r\n}\r\n\r\nfunction getReactContainerElement()\r\n{\r\n\tlet element = document.getElementById('react')\r\n\r\n\tif (!element) {\r\n\t\tconst body = document.body\r\n\t\tif (!body) {\r\n\t\t\tthrow new Error('<body/> tag not found, make sure this script is added to the end of <body/> rather than inside <head/>.')\r\n\t\t}\r\n\t\telement = document.createElement('div')\r\n\t\telement.setAttribute('id', 'react')\r\n\t\tbody.appendChild(element)\r\n\t}\r\n\r\n\treturn element\r\n}"],"file":"render.js"}