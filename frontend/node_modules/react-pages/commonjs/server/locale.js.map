{"version":3,"sources":["../../source/server/locale.js"],"names":["getPreferredLocales","headers","getLocalesFromHeader","accepts","regExp","locales","match","length","exec","locale","toUpperCase","push"],"mappings":";;;;;;;AAAA;AACA;AACO,SAASA,mBAAT,CAA6BC,OAA7B,EAAsC;AAC5C,SAAOC,oBAAoB,CAACD,OAAO,CAAC,iBAAD,CAAR,CAA3B;AACA,C,CAED;AACA;AACA;AACA;AAEA;AACA;;;AACA,SAASC,oBAAT,GAA4C;AAAA,MAAdC,OAAc,uEAAJ,EAAI;AAC3C;AACA;AACA,MAAMC,MAAM,GAAG,yCAAf;AACA,MAAMC,OAAO,GAAG,EAAhB;AACA,MAAIC,KAAJ,CAL2C,CAM3C;AACA;;AACA,SAAOD,OAAO,CAACE,MAAR,GAAiB,EAAjB,KAAwBD,KAAK,GAAGF,MAAM,CAACI,IAAP,CAAYL,OAAZ,CAAhC,CAAP,EAA8D;AAC7D,QAAIM,MAAM,GAAGH,KAAK,CAAC,CAAD,CAAlB;;AACA,QAAIA,KAAK,CAACC,MAAN,GAAe,CAAf,IAAoBD,KAAK,CAAC,CAAD,CAA7B,EAAkC;AACjCG,MAAAA,MAAM,IAAIH,KAAK,CAAC,CAAD,CAAL,CAASI,WAAT,EAAV;AACA;;AACDL,IAAAA,OAAO,CAACM,IAAR,CAAaF,MAAb;AACA;;AACD,SAAOJ,OAAP;AACA,C,CAED;AACA;AACA;AACA","sourcesContent":["// Based on `koa-locale`\r\n// https://github.com/koa-modules/locale/blob/master/index.js\r\nexport function getPreferredLocales(headers) {\r\n\treturn getLocalesFromHeader(headers['accept-language'])\r\n}\r\n\r\n// // From query, `locale=en`\r\n// function getLocaleFromQuery(query) {\r\n// \treturn query.locale\r\n// }\r\n\r\n// Parses locales from `Accept-Language` HTTP header.\r\n// Copy-pasted from somewhere on stackoverflow.com.\r\nfunction getLocalesFromHeader(accepts = '') {\r\n\t// E.g. \"Accept-Language\": \"da, en-gb;q=0.8, en;q=0.7\".\r\n\t// Global regular expressions are stateful so it's recreated on each function call.\r\n\tconst regExp = /(^|,\\s*)(?:([a-z]{1,8})(-[A-z]{1,8})?)/g\r\n\tconst locales = []\r\n\tlet match\r\n\t// Terminates at 10 preferred locales max.\r\n\t// (to protect from a possible overflow attack)\r\n\twhile (locales.length < 10 && (match = regExp.exec(accepts))) {\r\n\t\tlet locale = match[2]\r\n\t\tif (match.length > 3 && match[3]) {\r\n\t\t\tlocale += match[3].toUpperCase()\r\n\t\t}\r\n\t\tlocales.push(locale)\r\n\t}\r\n\treturn locales\r\n}\r\n\r\n// // From cookie, e.g. `locale=zh-CN`\r\n// function getLocaleFromCookie(cookie) {\r\n// \treturn cookie\r\n// }"],"file":"locale.js"}